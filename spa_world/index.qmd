---
title: "Population mondiale"
format:
  html:
    echo: false
    code-tools: true
    page-layout: full
---

```{ojs}
//| panel: sidebar
viewof year =  Inputs.range(
  [1990, 2019], 
  {value: 2019, step: 1, label: "Ann√©e"}
)
html`<br/><b>Configuration de la carte<b/>`
viewof k =  Inputs.range(
  [20, 100], 
  {value: 50, step: 1, label: "Rayon max"}
)
viewof proj = Inputs.select(projections, {label: "Projection"})
viewof toggle = Inputs.toggle({label: "Supperposition", value: true})
viewof color = Inputs.color({label: "couleur", value: "#ee3a3a"})
```


::: {.panel-tabset .ojs-track-layout}
## Plot

```{ojs}
bertin.draw({
params: {projection: proj, clip: true }, 
layers:[
  {type: "bubble", geojson: data, values: "POP", fill: color, dorling: !toggle, fixmax: popmax, k, tooltip: ["$name", "$region", d => Math.round(d.properties.POP / 1000000) + " millions d'hab."]},
  {geojson: world, fill: "#CCC"},
  {type: "graticule"},  
  {type: "outline"}
]})
```

## Data

```{ojs}
Inputs.table(statsyear, {  columns: [
    "country",
    "capital_city",
    "region",
    "POP"
  ]})
```
:::

<!-- ANNEXES TECHNIQUES -->

<!-- Libs -->

```{ojs}
bertin = require("bertin@1.5.9")
```

<!-- projections -->

```{ojs}
projections = ["Polar", "InterruptedSinusoidal", "Armadillo", "Baker", "Gingery", "Berghaus", "Loximuthal", "Healpix", "InterruptedMollweideHemispheres", "Miller", "Aitoff", "Spilhaus"]
```

<!-- Data handling -->

```{ojs}
world = FileAttachment("data/world.json").json()
stats = FileAttachment("data/worldbank_data.csv").csv()
statsyear = stats.filter(d => d.date == year)
data = bertin.merge(world, "id", statsyear, "iso3c")
popmax = d3.max(stats.filter(d => d.date == 2019), d => +d.POP)
```

